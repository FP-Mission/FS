<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../Autocoders/Python/schema/ISF/component_schema.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<component name="Gps" kind="passive" namespace="App">
    <comment>Component handling the FlexTrak GPS</comment>
    
    <import_port_type>Svc/Sched/SchedPortAi.xml</import_port_type>
    <import_port_type>App/FlexTrak/Position/PositionPortAi.xml</import_port_type>
    <import_serializable_type>App/FlexTrak/Position/PositionSerializableAi.xml</import_serializable_type>
    
    <ports>
        <port name="Run" data_type="Svc::Sched" kind="sync_input" >
            <comment>
                Run port for gps lock check
            </comment>
        </port>
        <port name="positionOut" data_type="App::Position" kind="output" max_number="2">
            <comment>
                GPS Position output
            </comment>
        </port>
        <port name="positionIn" data_type="App::Position" kind="sync_input" max_number="1">
            <comment>
                Current balloon position
            </comment>
        </port>
    </ports>

    <commands>
        <command kind="sync" opcode="0" mnemonic="Gps_GetLockState">
            <comment>
                Get current lock state
            </comment>
        </command>
    </commands>

    <telemetry>
        <channel id="0" name="Gps_Position" data_type="App::PositionSer">
            <comment>
                GPS position
            </comment>
        </channel>
        <channel id="1" name="Gps_LockState" data_type="U8">
            <comment>
                Lock state
            </comment>
        </channel>
    </telemetry>
    
    <events>
        <event id="0" name="Gps_LockState" severity="ACTIVITY_LO" format_string = "Lock state: %u" >
            <comment>
                Get lock state. 1: Locked (signal), 0: Unlocked (no signal)
            </comment>
            <args>
                <arg name="state" type="U8">
                    <comment>Lock state</comment>
                </arg>          
            </args>
        </event>
    </events>
</component>
