<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../Autocoders/Python/schema/ISF/topology_schema.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<assembly name="App">

    <!-- ############################# -->
    <!-- Import component declarations -->
    <!-- ############################# -->

    <import_component_type>Svc/FatalHandler/FatalHandlerComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveRateGroup/ActiveRateGroupComponentAi.xml</import_component_type>
    <import_component_type>Ref/PingReceiver/PingReceiverComponentAi.xml</import_component_type>
    <import_component_type>Svc/TlmChan/TlmChanComponentAi.xml</import_component_type>
    <import_component_type>Svc/CmdDispatcher/CommandDispatcherComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveRateGroup/ActiveRateGroupComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveRateGroup/ActiveRateGroupComponentAi.xml</import_component_type>
    <import_component_type>Svc/AssertFatalAdapter/AssertFatalAdapterComponentAi.xml</import_component_type>
    <import_component_type>Svc/Health/HealthComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveLogger/ActiveLoggerComponentAi.xml</import_component_type>
    <import_component_type>Svc/Time/TimeComponentAi.xml</import_component_type>
    <import_component_type>Svc/RateGroupDriver/RateGroupDriverComponentAi.xml</import_component_type>
    <import_component_type>Drv/BlockDriver/BlockDriverComponentAi.xml</import_component_type>
    <import_component_type>Svc/PassiveConsoleTextLogger/PassiveTextLoggerComponentAi.xml</import_component_type>
    <import_component_type>Svc/GroundInterface/GroundInterfaceComponentAi.xml</import_component_type>
    <import_component_type>Svc/LinuxTimer/LinuxTimerComponentAi.xml</import_component_type>

    <!-- ################################################################ -->
    <!-- Declare component instances - must match names in Components.hpp -->
    <!-- ################################################################ -->

    <!-- Core C&DH Components -->
    <instance namespace="Svc" name="health"         type="Health"               base_id="27"   base_id_window="8" />
    <instance namespace="Svc" name="eventLogger"    type="ActiveLogger"         base_id="36"   base_id_window="5" />
    <instance namespace="Svc" name="linuxTime"      type="Time"                 base_id="41"   base_id_window="0" />
    <instance namespace="Svc" name="textLogger"     type="PassiveTextLogger"    base_id="41"   base_id_window="0" />

    <!-- Rate Group Components -->
    <instance namespace="Svc" name="rateGroupDrv"   type="RateGroupDriver"      base_id="64"   base_id_window="0" />
    <instance namespace="Svc" name="rateGroup3"     type="ActiveRateGroup"      base_id="68"   base_id_window="2" />

    <!-- Reference Example Components -->
    <instance namespace="Ref" name="pingRcvr"       type="PingReceiver"         base_id="70"   base_id_window="2" />
    <instance namespace="Drv" name="blockDrv"       type="BlockDriver"          base_id="72"   base_id_window="1" />

    <!-- ########### -->
    <!-- Connections -->
    <!-- ########### -->  
 
    <!-- Event Logger Binary Connections -->
    <connection name="EventLoggerLog">
        <source component="eventLogger" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="HealthLog">
        <source component="health" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="RG3Ev">
         <source component="rateGroup3" port="Log" type="Log" num="0"/>
         <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="pingEvt">
         <source component="pingRcvr" port="Log" type="Log" num="0"/>
         <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
   
    <!-- Event Logger Text Connections -->
    <connection name="EventLoggerTextLog">
        <source component="eventLogger" port="LogText" type="LogText" num="0"/>
        <target component="textLogger" port="TextLogger" type="LogText" num="0"/>
    </connection>
    <connection name="HealthTextLog">
        <source component="health" port="LogText" type="LogText" num="0"/>
        <target component="textLogger" port="TextLogger" type="LogText" num="0"/>
    </connection>
    <connection name="Rg3Text">
         <source component="rateGroup3" port="LogText" type="LogText" num="0"/>
         <target component="textLogger" port="TextLogger" type="LogText" num="0"/>
    </connection>
    <connection name="PingText">
        <source component="pingRcvr" port="LogText" type="LogText" num="0"/>
        <target component="textLogger" port="TextLogger" type="LogText" num="0"/>
    </connection>

    <!-- Time Connections -->
    <connection name="eventLoggerTime">
        <source component="eventLogger" port="Time" type="Time" num="0"/>
        <target component="linuxTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="rg3Time">
         <source component="rateGroup3" port="Time" type="Time" num="0"/>
         <target component="linuxTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="healthTime">
        <source component="health" port="Time" type="Time" num="0"/>
        <target component="linuxTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="pingTime">
         <source component="pingRcvr" port="Time" type="Time" num="0"/>
         <target component="linuxTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="blockDrvTime">
         <source component="blockDrv" port="Time" type="Time" num="0"/>
         <target component="linuxTime" port="timeGetPort" type="Time" num="0"/>
    </connection>

    <!-- Rate Group Connections -->
   
        <!-- Linux Timer Connection -->
    <connection name="BlkDrvClock">
         <source component="blockDrv" port="CycleOut" type="Cycle" num="0"/>
         <target component="rateGroupDrv" port="CycleIn" type="Cycle" num="0"/>
    </connection>
   
        <!-- Rate Group 3 -->
    <connection name="rateGroup3DriverComp">
        <source component="rateGroupDrv" port="CycleOut" type="Cycle" num="2"/>
        <target component="rateGroup3" port="CycleIn" type="Cycle" num="0"/>
    </connection>
    
    <connection name="Rg3Health">
         <source component="rateGroup3" port="RateGroupMemberOut" type="Sched" num="0"/>
         <target component="health" port="Run" type="Sched" num="0"/>
    </connection>
    <connection name="Rg3BlkDrv">
         <source component="rateGroup3" port="RateGroupMemberOut" type="Sched" num="2"/>
         <target component="blockDrv" port="Sched" type="Sched" num="0"/>
    </connection>
    
    
    <!-- Health Connections -->
   
    <!-- The PingSend output port number should match the PingReturn input port number -->
    <!-- Each port number pair must be unique -->
    <!-- This order must match the pingEntries[] table in Ref/Top/Topology.cpp -->
    <connection name="Rg3PingSend">
         <source component="health" port="PingSend" type="Ping" num="0"/>
         <target component="rateGroup3" port="PingIn" type="Ping" num="0"/>
    </connection>
    <connection name="Rg3PingRecv">
         <source component="rateGroup3" port="PingOut" type="Ping" num="0"/>
         <target component="health" port="PingReturn" type="Ping" num="0"/>
    </connection>
    <connection name="eventLoggerPingSend">
        <source component="health" port="PingSend" type="Ping" num="1"/>
        <target component="eventLogger" port="pingIn" type="Ping" num="0"/>
    </connection>
    <connection name="eventLoggerPingRecv">
        <source component="eventLogger" port="pingOut" type="Ping" num="0"/>
        <target component="health" port="PingReturn" type="Ping" num="1"/>
    </connection>
    <connection name="PingRcvPingRecv">
         <source component="health" port="PingSend" type="Ping" num="2"/>
         <target component="pingRcvr" port="PingIn" type="Ping" num="0"/>
    </connection>
    <connection name="PingRcvPingSend">
         <source component="pingRcvr" port="PingOut" type="Ping" num="0"/>
         <target component="health" port="PingReturn" type="Ping" num="2"/>
    </connection>
    <connection name="blockDrvPingSend">
         <source component="health" port="PingSend" type="Ping" num="3"/>
         <target component="blockDrv" port="PingIn" type="Ping" num="0"/>
    </connection>
    <connection name="blockDrvPingRecv">
         <source component="blockDrv" port="PingOut" type="Ping" num="0"/>
         <target component="health" port="PingReturn" type="Ping" num="3"/>
    </connection> 
</assembly>
